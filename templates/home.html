{% extends "base.html" %}

{% block content %}
<div id="home-app"></div>
{% endblock %}

{% block scripts %}
<script type="text/babel">
    // Home App Component
    const HomeApp = () => {
        const [currentUser, setCurrentUser] = React.useState(window.AuthService?.currentUser || null);
        const [cartItems, setCartItems] = React.useState(window.CartManager?.getCart() || []);
        const [wishlist, setWishlist] = React.useState(window.WishlistManager?.getWishlist() || []);
        const [categories, setCategories] = React.useState([]);
        const [featuredProducts, setFeaturedProducts] = React.useState([]);
        const [loading, setLoading] = React.useState(true);

        React.useEffect(() => {
            loadProducts();
        }, []);

        const loadProducts = async () => {
            try {
                // Load categories
                const categoriesData = await window.ProductAPI?.fetchCategories();
                setCategories(categoriesData || []);
                
                // Load featured products
                const featuredData = await window.ProductAPI?.fetchFeaturedProducts();
                setFeaturedProducts(featuredData || []);
                
            } catch (error) {
                console.error('Error loading products:', error);
                setCategories([]);
                setFeaturedProducts([]);
            } finally {
                setLoading(false);
            }
        };

        const handleAddToCart = (product, size = 'M', quantity = 1) => {
            if (!window.CartManager) {
                alert('Cart system not available');
                return;
            }
            const updatedCart = window.CartManager.addToCart(product, size, quantity);
            setCartItems(updatedCart);
        };

        const handleWishlist = (product, isWishlisted) => {
            if (!window.WishlistManager) {
                alert('Wishlist system not available');
                return;
            }
            
            let updatedWishlist;
            if (isWishlisted) {
                updatedWishlist = window.WishlistManager.addToWishlist(product);
            } else {
                updatedWishlist = window.WishlistManager.removeFromWishlist(product.id);
            }
            setWishlist(updatedWishlist);
        };

        const handleViewDetails = (product) => {
            window.location.href = `/product/${product.id}`;
        };

        const handleShopNow = () => {
            const categoriesSection = document.querySelector('.categories');
            if (categoriesSection) {
                categoriesSection.scrollIntoView({ behavior: 'smooth' });
            }
        };

        const showToast = (message, type = '') => {
            // Simple toast implementation
            alert(`${type ? type + ': ' : ''}${message}`);
        };

        const handleLoginClick = () => {
            window.location.href = '/login';
        };

        const handleCartClick = () => {
            window.location.href = '/cart';
        };

        const handleWishlistClick = () => {
            window.location.href = '/wishlist';
        };

        const handleLogout = () => {
            if (window.AuthService) {
                window.AuthService.logout();
                setCurrentUser(null);
                showToast('You have been logged out', 'info');
            }
        };

        const handleAccountClick = () => {
            window.location.href = '/account';
        };

        const cartCount = cartItems.reduce((total, item) => total + item.quantity, 0);
        const wishlistCount = wishlist.length;

        // Header Component
        const Header = () => {
            const handleCategoryClick = (categoryId) => {
                const element = document.getElementById(`anime-${categoryId}`);
                if (element) {
                    element.scrollIntoView({ behavior: 'smooth' });
                }
            };

            return React.createElement('header', null,
                React.createElement('div', { className: 'container' },
                    React.createElement('div', { className: 'header-top' },
                        React.createElement('div', { className: 'logo' },
                            React.createElement('i', { className: 'fas fa-mask' }),
                            React.createElement('span', null, 'AnimeCosplay India')
                        ),
                        React.createElement('div', { className: 'search-bar' },
                            React.createElement('input', { 
                                type: 'text', 
                                placeholder: 'Search for costumes, accessories...' 
                            }),
                            React.createElement('button', null,
                                React.createElement('i', { className: 'fas fa-search' })
                            )
                        ),
                        React.createElement('div', { className: 'header-actions' },
                            currentUser ? 
                                React.createElement('div', { className: 'user-profile' },
                                    React.createElement('div', { className: 'header-action', onClick: handleAccountClick },
                                        React.createElement('i', { className: 'fas fa-user' }),
                                        React.createElement('span', null, currentUser.name.split(' ')[0])
                                    ),
                                    React.createElement('div', { className: 'header-action', onClick: handleLogout },
                                        React.createElement('i', { className: 'fas fa-sign-out-alt' }),
                                        React.createElement('span', null, 'Logout')
                                    )
                                ) :
                                React.createElement('div', { className: 'header-action', onClick: handleLoginClick },
                                    React.createElement('i', { className: 'fas fa-user' }),
                                    React.createElement('span', null, 'Login')
                                ),
                            React.createElement('div', { className: 'header-action wishlist-icon', onClick: handleWishlistClick },
                                React.createElement('i', { className: 'fas fa-heart' }),
                                React.createElement('span', null, 'Wishlist'),
                                React.createElement('div', { className: 'wishlist-count' }, wishlistCount)
                            ),
                            React.createElement('div', { className: 'header-action cart-icon', onClick: handleCartClick },
                                React.createElement('i', { className: 'fas fa-shopping-cart' }),
                                React.createElement('span', null, 'Cart'),
                                React.createElement('div', { className: 'cart-count' }, cartCount)
                            )
                        )
                    ),
                    React.createElement('nav', null,
                        React.createElement('ul', { className: 'nav-links' },
                            React.createElement('li', null,
                                React.createElement('a', { 
                                    href: '#', 
                                    onClick: (e) => { e.preventDefault(); window.scrollTo(0, 0); } 
                                }, 'Home')
                            ),
                            categories.map(category => 
                                React.createElement('li', { key: category.id },
                                    React.createElement('a', { 
                                        href: '#', 
                                        onClick: (e) => { e.preventDefault(); handleCategoryClick(category.id); }
                                    }, category.name)
                                )
                            )
                        )
                    )
                )
            );
        };

        // Hero Component
        const Hero = () => {
            return React.createElement('section', { className: 'hero' },
                React.createElement('div', { className: 'container' },
                    React.createElement('div', { className: 'hero-content' },
                        React.createElement('h1', null, 'Premium Anime Cosplay Costumes'),
                        React.createElement('p', null, 'Discover the largest collection of authentic anime cosplay costumes in India. From Naruto to Demon Slayer, we have everything you need for your next convention or event.'),
                        React.createElement('a', { 
                            href: '#', 
                            className: 'cta-button',
                            onClick: (e) => { e.preventDefault(); handleShopNow(); }
                        }, 'Shop Now ', React.createElement('i', { className: 'fas fa-arrow-right' }))
                    )
                )
            );
        };

        // Product Card Component
        const ProductCard = ({ product, onAddToCart, onWishlist, isWishlisted, onViewDetails }) => {
            const renderStars = (rating) => {
                const stars = [];
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 !== 0;

                for (let i = 0; i < fullStars; i++) {
                    stars.push(React.createElement('i', { key: i, className: "fas fa-star" }));
                }

                if (hasHalfStar) {
                    stars.push(React.createElement('i', { key: "half", className: "fas fa-star-half-alt" }));
                }

                const emptyStars = 5 - stars.length;
                for (let i = 0; i < emptyStars; i++) {
                    stars.push(React.createElement('i', { key: `empty-${i}`, className: "far fa-star" }));
                }

                return stars;
            };

            return React.createElement('div', { className: 'product-card fade-in' },
                React.createElement('div', { 
                    className: 'product-img', 
                    style: { backgroundImage: `url(${product.image || product.imageUrl})` } 
                },
                    product.badge && React.createElement('div', { 
                        className: `product-badge ${product.badge.toLowerCase().replace(/ /g, '-')}` 
                    }, product.badge)
                ),
                React.createElement('div', { className: 'product-info' },
                    React.createElement('div', { className: 'product-title' }, product.name),
                    React.createElement('div', { className: 'product-price' }, `₹${product.price.toLocaleString()}`),
                    React.createElement('div', { className: 'product-rating' },
                        renderStars(product.rating),
                        React.createElement('span', null, `(${product.reviews})`)
                    ),
                    React.createElement('div', { className: 'product-actions' },
                        React.createElement('button', { 
                            className: 'add-to-cart', 
                            onClick: (e) => { e.stopPropagation(); onAddToCart(product); }
                        },
                            React.createElement('i', { className: 'fas fa-shopping-cart' }),
                            ' Add to Cart'
                        ),
                        React.createElement('button', { 
                            className: `wishlist ${isWishlisted ? 'active' : ''}`, 
                            onClick: (e) => { e.stopPropagation(); onWishlist(product, !isWishlisted); }
                        },
                            React.createElement('i', { className: isWishlisted ? "fas fa-heart" : "far fa-heart" })
                        )
                    ),
                    React.createElement('button', { 
                        className: 'view-details', 
                        onClick: (e) => { e.stopPropagation(); onViewDetails(product); }
                    },
                        React.createElement('i', { className: 'fas fa-eye' }),
                        ' View Details'
                    )
                )
            );
        };

        if (loading) {
            return React.createElement('div', { className: 'loading' },
                React.createElement('div', { className: 'spinner' })
            );
        }

        // Category images mapping
        const categoryImages = {
            "naruto": "https://i.pinimg.com/736x/82/69/3e/82693ee38e59d0858d7aff9c721a5644.jpg",
            "attack-on-titan": "https://images.justwatch.com/poster/306747132/s718/attack-on-titan.jpg",
            "one-piece": "https://comicvine.gamespot.com/a/uploads/scale_small/11117/111178336/7080202-1635462455-unkno.png",
            "demon-slayer": "https://m.media-amazon.com/images/I/71EJ6ivzmuS._AC_UF894,1000_QL80_.jpg",
            "my-hero-academia": "https://m.media-amazon.com/images/I/61D9h46CNiL._AC_UF1000,1000_QL80_.jpg",
            "tokyo-ghoul": "https://geekygirlwritesblog.wordpress.com/wp-content/uploads/2017/01/tokyo_ghoul_5787.jpg",
            "death-note": "https://upload.wikimedia.org/wikipedia/en/6/6f/Death_Note_Vol_1.jpg",
            "dragon-ball": "https://storage.googleapis.com/pod_public/750/260203.jpg",
            "sailor-moon": "https://images-cdn.ubuy.co.in/633fd4c217f1e7515425a44c-sailor-moon-season-1-part-2-dvd.jpg",
            "fullmetal-alchemist": "https://vignette.wikia.nocookie.net/fma/images/e/e9/Fmab-poster.png/revision/latest?cb=20131124145205",
            "solo-leveling": "https://i.pinimg.com/736x/68/f9/81/68f98176832dd0d1b365ef6bd883d494.jpg"
        };

        return React.createElement('div', null,
            React.createElement(Header),
            React.createElement(Hero),
            React.createElement('section', { className: 'container' },
                React.createElement('h2', { className: 'section-title' }, 'Shop By Anime'),
                React.createElement('div', { className: 'categories' },
                    categories.map(category => {
                        return React.createElement('div', { 
                            key: category.id,
                            className: 'category-card',
                            onClick: () => {
                                const element = document.getElementById(`anime-${category.id}`);
                                if (element) {
                                    element.scrollIntoView({ behavior: 'smooth' });
                                }
                            }
                        },
                            React.createElement('div', { 
                                className: 'category-img', 
                                style: { backgroundImage: `url(${categoryImages[category.id] || 'https://images.unsplash.com/photo-1578662996442-48f60103fc96?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=600&q=80'})` } 
                            }),
                            // React.createElement('div', { className: 'category-name' }, category.name),
                            React.createElement('div', { className: 'category-overlay' },
                                React.createElement('span', null, `View ${category.name} Costumes`)
                            )
                        );
                    })
                )
            ),
            featuredProducts.length > 0 && React.createElement('section', { className: 'container' },
                React.createElement('h2', { className: 'section-title' }, 'Featured Costumes'),
                React.createElement('div', { className: 'products' },
                    featuredProducts.map(product => 
                        React.createElement(ProductCard, {
                            key: product.id,
                            product,
                            onAddToCart: handleAddToCart,
                            onWishlist: handleWishlist,
                            isWishlisted: window.WishlistManager?.isInWishlist(product.id) || false,
                            onViewDetails: handleViewDetails
                        })
                    )
                )
            ),
            categories.map(category => {
                if (!category.products || category.products.length === 0) return null;
                
                return React.createElement('section', { 
                    key: category.id,
                    className: 'container anime-section',
                    id: `anime-${category.id}`
                },
                    React.createElement('div', { className: 'anime-header' },
                        React.createElement('h2', { className: 'anime-title' }, category.name),
                        React.createElement('a', { href: '#', className: 'view-all' },
                            'View All ',
                            React.createElement('i', { className: 'fas fa-arrow-right' })
                        )
                    ),
                    React.createElement('p', { 
                        className: 'text-center mb-0',
                        style: { fontSize: '1.1rem', color: '#6c757d', marginBottom: '30px' }
                    }, `Dress up as your favorite characters from ${category.name}!`),
                    React.createElement('div', { className: 'products' },
                        category.products.map(product => 
                            React.createElement(ProductCard, {
                                key: product.id,
                                product,
                                onAddToCart: handleAddToCart,
                                onWishlist: handleWishlist,
                                isWishlisted: window.WishlistManager?.isInWishlist(product.id) || false,
                                onViewDetails: handleViewDetails
                            })
                        )
                    )
                );
            }),
            React.createElement('footer', null,
                React.createElement('div', { className: 'container' },
                    React.createElement('div', { className: 'footer-content' },
                        React.createElement('div', { className: 'footer-column' },
                            React.createElement('h3', null, 'AnimeCosplay India'),
                            React.createElement('p', null, 'Your one-stop destination for premium anime cosplay costumes and accessories in India. We bring your favorite characters to life with authentic designs and quality materials.'),
                            React.createElement('div', { className: 'social-links' },
                                React.createElement('a', { href: '#' }, React.createElement('i', { className: 'fab fa-facebook-f' })),
                                React.createElement('a', { href: '#' }, React.createElement('i', { className: 'fab fa-twitter' })),
                                React.createElement('a', { href: '#' }, React.createElement('i', { className: 'fab fa-instagram' })),
                                React.createElement('a', { href: '#' }, React.createElement('i', { className: 'fab fa-youtube' })),
                                React.createElement('a', { href: '#' }, React.createElement('i', { className: 'fab fa-pinterest' }))
                            )
                        ),
                        React.createElement('div', { className: 'footer-column' },
                            React.createElement('h3', null, 'Shop'),
                            React.createElement('ul', { className: 'footer-links' },
                                categories.slice(0, 5).map(category =>
                                    React.createElement('li', { key: category.id },
                                        React.createElement('a', { href: '#' },
                                            React.createElement('i', { className: 'fas fa-chevron-right' }),
                                            `${category.name} Costumes`
                                        )
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: 'footer-column' },
                            React.createElement('h3', null, 'Customer Service'),
                            React.createElement('ul', { className: 'footer-links' },
                                ['Contact Us', 'Shipping Policy', 'Returns & Exchanges', 'Size Guide', 'FAQs'].map(item =>
                                    React.createElement('li', { key: item },
                                        React.createElement('a', { href: '#' },
                                            React.createElement('i', { className: 'fas fa-chevron-right' }),
                                            item
                                        )
                                    )
                                )
                            )
                        ),
                        React.createElement('div', { className: 'footer-column' },
                            React.createElement('h3', null, 'Contact Info'),
                            React.createElement('ul', { className: 'footer-links' },
                                React.createElement('li', null,
                                    React.createElement('a', { href: '#' },
                                        React.createElement('i', { className: 'fas fa-map-marker-alt' }),
                                        'Salem, Tamil Nadu'
                                    )
                                ),
                                React.createElement('li', null,
                                    React.createElement('a', { href: '#' },
                                        React.createElement('i', { className: 'fas fa-phone' }),
                                        '+91 98765 43210'
                                    )
                                ),
                                React.createElement('li', null,
                                    React.createElement('a', { href: '#' },
                                        React.createElement('i', { className: 'fas fa-envelope' }),
                                        'support@animecosplayindia.com'
                                    )
                                ),
                                React.createElement('li', null,
                                    React.createElement('a', { href: '#' },
                                        React.createElement('i', { className: 'fas fa-clock' }),
                                        'Mon-Sun: 10:00 AM - 8:00 PM'
                                    )
                                )
                            ),
                            React.createElement('div', { className: 'newsletter' },
                                React.createElement('p', null, 'Subscribe to our newsletter for updates'),
                                React.createElement('div', { className: 'newsletter-form' },
                                    React.createElement('input', { type: 'email', placeholder: 'Your email address' }),
                                    React.createElement('button', null, React.createElement('i', { className: 'fas fa-paper-plane' }))
                                )
                            )
                        )
                    ),
                    React.createElement('div', { className: 'footer-bottom' },
                        React.createElement('p', null, 
                            '© 2023 AnimeCosplay India. All rights reserved. | Designed with ',
                            React.createElement('i', { className: 'fas fa-heart', style: { color: '#ff3e6c' } }),
                            ' for anime fans'
                        )
                    )
                )
            )
        );
    };

    // Render the app
    ReactDOM.render(React.createElement(HomeApp), document.getElementById('home-app'));
</script>
{% endblock %}